Database Layer
TypeORM datasource, migrations, fixtures, and seed scripts for PostgreSQL.

The db directory manages the PostgreSQL database lifecycle. It contains the TypeORM `DataSource` initialization (with pgvector support), ~45 sequential migrations tracking every schema change, a minimal development fixture, and seed scripts that directly use TypeORM repositories to populate test data outside of NestJS dependency injection.

The `datasource.ts` file creates and exports a standalone TypeORM `DataSource` used by both the application and migration CLI. It applies a hack to register `vector` as a supported column type for pgvector compatibility. The `migrations/` directory contains chronologically ordered migration files (timestamped from `1750087277319-InitialSchema` through `1771435357941-AddStackitToModelProviderEnum`) covering the full schema evolution: initial tables, subscriptions, models, permitted providers, legal acceptances, agents, threads, sources, RAG vectors, MCP integrations, shares, skills, teams, usage tracking, and multi-provider support. The `fixtures/` directory holds `minimal.fixture.ts` defining a canonical development dataset (one org, admin user, Claude Sonnet 4 Bedrock language model, Text Embedding 3 Large OpenAI embedding model, active subscription with permitted models). The `scripts/` directory contains `seed-minimal.ts`, a standalone script that initializes the datasource directly, creates fixture data using raw TypeORM repositories (bypassing NestJS DI), and handles idempotent seeding with existence checks. Independent entities (org, language model, embedding model) are seeded in parallel before dependent entities (user, subscription, permitted models). The script supports a `--clean` flag to truncate all tables before seeding. A `SeedRunner` utility in `scripts/utils/` provides password hashing, production environment guards, and `truncateAll` capability for clean re-seeding.
