#!/usr/bin/env sh

# Validate commit message for required conventions
# - Must include the prefix "LOC-" somewhere (e.g., LOC-123)
# - Must start with a type prefix like feat/fix/feature/chore/etc. (Conventional Commit style)
# Husky passes the commit message file path as $1

MSG_FILE="$1"

# Extract the first non-comment, non-empty line as the subject
SUBJECT=$(grep -vE '^\s*#' "$MSG_FILE" | sed '/^\s*$/d' | head -n 1)

# 1) Require type prefix at start (case-insensitive):
#    feat|feature|fix|chore|refactor|docs|style|perf|test|build|ci|revert|check
echo "$SUBJECT" | grep -qiE '^(feat|feature|fix|chore|refactor|docs|style|perf|test|build|ci|revert|check)(\(.+\))?:\s' || {
  printf "\033[31mCommit message must start with a type (e.g., feat:, fix:, feature:, chore:, ...).\033[0m\n" >&2
  printf "Examples:\n  feat: add new booking widget\n  fix: correct date validation\n  feature: implement task board drag-and-drop\n" >&2
  exit 1
}

# 2) Require AYC- anywhere in the message (exclude commented lines)
if ! grep -vE '^\s*#' "$MSG_FILE" | grep -qi 'AYC-'; then
  printf "\033[31mCommit message must include task ID with AYC- prefix (e.g., AYC-123).\033[0m\n" >&2
  printf "Example: git commit --amend -m 'feat: validate input (AYC-123)'\n" >&2
  exit 1
fi

exit 0


